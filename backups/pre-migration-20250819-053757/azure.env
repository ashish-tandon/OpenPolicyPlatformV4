# ========================================
# AZURE ENVIRONMENT CONFIGURATION
# OpenPolicyPlatform V4 - Production Azure Environment
# ========================================

# ========================================
# REDIS MIGRATION CONFIGURATION
# ========================================
# Migration modes: local, dual, azure
REDIS_MIGRATION_MODE=dual

# Local Redis (fallback)
LOCAL_REDIS_URL=redis://localhost:6379/0

# Azure Redis Cache
AZURE_REDIS_URL=rediss://:<REDIS_PASSWORD>@openpolicy-redis.redis.cache.windows.net:6380
AZURE_REDIS_HOST=openpolicy-redis.redis.cache.windows.net
AZURE_REDIS_PORT=6380
AZURE_REDIS_SSL=true

# ========================================
# AZURE POSTGRESQL DATABASE
# ========================================
AZURE_POSTGRES_URL=postgresql://openpolicy:<POSTGRES_PASSWORD>@openpolicy-postgresql.postgres.database.azure.com:5432/openpolicy
AZURE_POSTGRES_HOST=openpolicy-postgresql.postgres.database.azure.com
AZURE_POSTGRES_PORT=5432
AZURE_POSTGRES_DB=openpolicy
AZURE_POSTGRES_USER=openpolicy
AZURE_POSTGRES_SSL=require

# ========================================
# AZURE STORAGE ACCOUNT
# ========================================
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=openpolicystorage;AccountKey=<STORAGE_ACCOUNT_KEY>;EndpointSuffix=core.windows.net
AZURE_STORAGE_ACCOUNT_NAME=openpolicystorage
AZURE_STORAGE_ACCOUNT_KEY=<STORAGE_ACCOUNT_KEY>

# ========================================
# AZURE APPLICATION INSIGHTS
# ========================================
AZURE_APPINSIGHTS_KEY=518f6097-e920-4994-a055-f8b89e40e0b1
AZURE_APPINSIGHTS_CONNECTION_STRING=InstrumentationKey=518f6097-e920-4994-a055-f8b89e40e0b1;IngestionEndpoint=https://canadacentral-1.in.applicationinsights.azure.com/;LiveEndpoint=https://canadacentral.livediagnostics.monitor.azure.com/;ApplicationId=fea4b3f9-5b52-4ccf-89a9-9bd34122b194

# ========================================
# AZURE KEY VAULT
# ========================================
AZURE_KEY_VAULT_URL=https://openpolicy-keyvault.vault.azure.net/
AZURE_KEY_VAULT_NAME=openpolicy-keyvault

# ========================================
# AZURE CONTAINER REGISTRY
# ========================================
AZURE_ACR_LOGIN_SERVER=openpolicyacr.azurecr.io
AZURE_ACR_NAME=openpolicyacr

# ========================================
# APPLICATION CONFIGURATION
# ========================================
ENVIRONMENT=production
LOG_LEVEL=info
DEBUG=false
SECRET_KEY=<SECRET_KEY>

# ========================================
# SERVICE CONFIGURATION
# ========================================
API_HOST=0.0.0.0
API_PORT=8000
WEB_HOST=0.0.0.0
WEB_PORT=3000
GATEWAY_HOST=0.0.0.0
GATEWAY_PORT=80

# ========================================
# DATABASE CONFIGURATION
# ========================================
DATABASE_URL=${AZURE_POSTGRES_URL}
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=30
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600

# ========================================
# REDIS CONFIGURATION
# ========================================
REDIS_URL=${AZURE_REDIS_URL}
REDIS_HOST=${AZURE_REDIS_HOST}
REDIS_PORT=${AZURE_REDIS_PORT}
REDIS_SSL=${AZURE_REDIS_SSL}
REDIS_POOL_SIZE=20
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_RETRY_ON_TIMEOUT=true

# ========================================
# CACHE CONFIGURATION
# ========================================
CACHE_TYPE=redis
CACHE_REDIS_URL=${AZURE_REDIS_URL}
CACHE_DEFAULT_TIMEOUT=300
CACHE_KEY_PREFIX=openpolicy:

# ========================================
# SESSION CONFIGURATION
# ========================================
SESSION_TYPE=redis
SESSION_REDIS_URL=${AZURE_REDIS_URL}
SESSION_KEY_PREFIX=session:
SESSION_TIMEOUT=3600

# ========================================
# MONITORING CONFIGURATION
# ========================================
ENABLE_METRICS=true
ENABLE_HEALTH_CHECKS=true
HEALTH_CHECK_INTERVAL=30
METRICS_INTERVAL=60

# ========================================
# SECURITY CONFIGURATION
# ========================================
CORS_ORIGINS=https://openpolicy.me,https://www.openpolicy.me
ALLOWED_HOSTS=openpolicy.me,www.openpolicy.me,localhost,127.0.0.1
CSRF_TRUSTED_ORIGINS=https://openpolicy.me,https://www.openpolicy.me

# ========================================
# LOGGING CONFIGURATION
# ========================================
LOG_FORMAT=json
LOG_LEVEL_FILE=info
LOG_LEVEL_CONSOLE=info
LOG_FILE_PATH=/var/log/openpolicy
LOG_MAX_SIZE=100MB
LOG_BACKUP_COUNT=5

# ========================================
# PERFORMANCE CONFIGURATION
# ========================================
WORKER_PROCESSES=4
WORKER_THREADS=2
MAX_REQUESTS=1000
MAX_REQUESTS_JITTER=100
TIMEOUT=30
KEEPALIVE=2

# ========================================
# AZURE SPECIFIC SETTINGS
# ========================================
AZURE_LOCATION=canadacentral
AZURE_RESOURCE_GROUP=openpolicy-platform-rg
AZURE_SUBSCRIPTION_ID=5602b849-384e-4da7-8b75-fd5eb70ea355
AZURE_TENANT_ID=df5fb449-645c-4cc0-82a7-7d7a052d939a

# ========================================
# MIGRATION SETTINGS
# ========================================
ENABLE_DUAL_WRITE=true
ENABLE_FALLBACK=true
MIGRATION_MONITORING=true
MIGRATION_ALERTS=true

# ========================================
# NOTES
# ========================================
# Replace the following placeholders with actual values:
# - <REDIS_PASSWORD>: Get from Azure Redis Cache keys
# - <POSTGRES_PASSWORD>: Get from Azure PostgreSQL
# - <STORAGE_ACCOUNT_KEY>: Get from Azure Storage Account
# - <SECRET_KEY>: Generate a secure random key
#
# To get these values, run:
# az redis list-keys --name openpolicy-redis --resource-group openpolicy-platform-rg
# az postgres flexible-server show --name openpolicy-postgresql --resource-group openpolicy-platform-rg
# az storage account keys list --name openpolicystorage --resource-group openpolicy-platform-rg
